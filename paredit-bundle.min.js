!function(){var e="undefined"!=typeof module&&module.require,n=e?module.exports:window.paredit={};e&&(n.reader=module.require("./lib/reader").reader,n.navigator=module.require("./lib/navigator").navigator,n.editor=module.require("./lib/editor").editor),n.parse=function(e,t){t=t||{};var r=t.hasOwnProperty("addSourceForLeafs")?t.addSourceForLeafs:!0,i=[],o=n.reader.readSeq(e,function(n,t,o,u,l){var a={type:n,start:o.idx,end:u.idx};return"error"===n?(a.error=t.error,i.push(a)):r&&"list"!==n&&(a.source=e.slice(a.start,a.end)),"list"===n&&(a.children=t),("list"===n||"string"===n)&&(a.open=l.open,a.close=l.close),a});return{type:"toplevel",start:0,end:o&&o.length&&o[o.length-1].end||0,errors:i,children:o}}}(),function(e){var n="undefined"!=typeof module&&module.require,t=n?module.exports:window.paredit;e(t)}(function(e){var n=e.util={merge:function(e){return arguments.length>1?n.merge(Array.prototype.slice.call(arguments)):Array.isArray(e[0])?Array.prototype.concat.apply([],e):e.reduce(function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e},{})},mapTree:function(e,t,r){var i=(r(e)||[]).map(function(e){return n.mapTree(e,t,r)});return t(e,i)},flatFilterTree:function(e,t,r){var i=[];return t(e)&&i.push(e),i.concat((r(e)||[]).reduce(function(e,i){return e.concat(n.flatFilterTree(i,t,r))},[]))},last:function(e){return e[e.length-1]},times:function(e,n){return new Array(e+1).join(n)},clone:function(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var n={};for(var t in e)n[t]=e[t];return n}}}),function(e){var n="undefined"!=typeof module&&module.require,t=n?module.exports:window.paredit;e(t)}(function(e){function n(e,n,d,p,g){var v=n[0];if(!v&&e&&y[e])return{input:n,context:d,pos:p,flag:w};if(!v&&!y[e])return{input:n,context:d,pos:p,flag:w};if(/\s|,/.test(v))return{input:n.slice(1),context:d,pos:x(p,v)};if(I.test(v))return a(n,d,p,g);if(";"===v)return l(n,d,p,g);if('"'===v)return r(n,d,p,g);if("\\"===v)return i(n,d,p,g);if(/[0-9]/.test(v))return u(n,d,p,g);if(b.test(v))return o(n,d,p,g);if(A.indexOf(v)>-1){if(!e){var k=c(n,d,p,g);return{input:k.input,context:k.context,pos:k.pos}}return{input:n,context:d,pos:p,flag:m}}if(S.indexOf(v)>-1){var q,C,O=h(p),F=t(v,n.slice(1),Object.freeze([]),x(p,v),g),T=F.input[0];if(T!==y[v]){var j=h(F.pos),R="Expected '"+y[v]+"'"+(T?" but got '"+T+"'":" but reached end of input"),E=s(R,O,j);q=f(g,"error",E,O,j),C=T?x(F.pos,T):F.pos}else C=T?x(F.pos,T):F.pos,q=f(g,"list",F.context,O,C,{open:v,close:y[v]});d=d.concat([q]);var z=F.input.slice(T?1:0);return{input:z,context:d,pos:C}}var O=h(p),j=x(p,v),E=s("Unexpected character: "+v,O,j);return E=f(g,"error",E,O,j),d=d.concat([E]),{input:n.slice(1),context:d,pos:j}}function t(e,t,r,i,o){for(var u,l=0;;){if(l++,l>1e4)throw new Error("endless loop at "+g(i));if(u=n(e,t,r,i,o),t=u.input,r=u.context,i=u.pos,u.flag===w||u.flag===m&&(e||!t.length))break}return{input:t,context:r,pos:i}}function r(e,n,t,r){var i=!1,o=h(t),u=e[0];return t=x(t,e[0]),e=e.slice(1),d(e,t,function(e){return i||'"'!==e?(i?i=!1:"\\"===e&&(i=!0),!0):!1},function(e,t,i,l){u=u+e+t[0],l=x(l,t[0]),t=t.slice(1);var a=f(r,"string",u,o,l,{open:'"',close:'"'});return n=n.concat([a]),{pos:l,input:t,context:n}})}function i(e,n,t,r){var i=h(t),o=e.slice(0,2),u=x(t,o),l=f(r,"char",o,i,u),a=e.slice(2);return n=n.concat([l]),{pos:u,input:a,context:n}}function o(e,n,t,r){return d(e,t,function(e){return b.test(e)},function(e,t,i,o){var u=f(r,"symbol",e,i,o);return n=n.concat([u]),{pos:o,input:t,context:n}})}function u(e,n,t,r){return d(e,t,function(e){return/[0-9]/.test(e)},function(e,t,i,o){var u=f(r,"number",Number(e),i,o);return n=n.concat([u]),{pos:o,input:t,context:n}})}function l(e,n,t,r){for(var i=h(t),o="",u=e;u.length&&/^\s*;/.test(u);){var l=v(u);o+=l[0],u=l[1]}var a=x(t,o),c=f(r,"comment",o,i,a);return n=n.concat([c]),{pos:a,input:u,context:n}}function a(e,n,t,r){return d(e,t,function(e){return I.test(e)},function(e,t,i,o){var u=f(r,"special",e,i,o);return n=n.concat([u]),{pos:o,input:t,context:n}})}function c(e,n,t,r){return d(e,t,function(e){return A.indexOf(e)>-1},function(e,t,i,o){var u=s("Unexpected input: '"+e+"'",i,o),l=f(r,"error",u,i,o);return n=n.concat([l]),{pos:o,input:t,context:n}})}function s(e,n,t){return{error:e+" at line "+(t.row+1)+" column "+t.column,start:h(n),end:h(t)}}function f(e,n,t,r,i,o){return e?e(n,t,h(r),h(i),o):t}function d(e,n,t,r){for(var i=h(n),o="",u=0;u<e.length&&t(e[u]);u++)o+=e[u];return r(o,e.slice(o.length),i,x(n,o))}function p(){return{idx:0,column:0,row:0}}function h(e){return{idx:e.idx,column:e.column,row:e.row}}function g(e){return JSON.stringify(e)}function v(e){var n=e.indexOf("\n");n=n>-1?n+1:e.length;var t=e.slice(0,n),r=e.slice(n);return[t,r]}function x(e,n){e.idx+=n.length;var t=n.split("\n"),r=t.length;e.row+=r-1;var i=t[r-1].length;return e.column=r>1?i:e.column+i,e}e.reader={readSeq:function(e,n){return t(null,e,Object.freeze([]),p(),n).context},readSexp:function(e,t){return n(null,e,Object.freeze([]),p(),t).context[0]}};var m={},w={},y={"[":"]","(":")","{":"}"},S=Object.keys(y),A=S.map(function(e){return y[e]}),b=/[^\s\[\]\(\)\{\},]/,I=/[`@^#~]/}),function(e){var n="undefined"!=typeof module&&module.require,t=n?module.exports:window.paredit,r=n?module.require("./util").util:window.paredit.util;e(r,t)}(function(e,n){function t(e){return e[e.length-1]}function r(e){return e.children||[]}var i=n.navigator={forwardSexp:function(e,n){var t=o.nextSexp(e,n);return t?t.end:n},backwardSexp:function(e,n){var t=o.prevSexp(e,n);return t?t.start:n},forwardDownSexp:function(e,n){var t=o.nextSexp(e,n,function(e){return"list"===e.type});return t?t.children&&t.children[0]?t.children[0].start:t.start+1:n},backwardUpSexp:function(e,n){var r=o.sexpsAt(e,n,function(e){return"list"===e.type&&e.start!==n&&e.end!==n});return r&&r.length?t(r).start:n},sexpRange:function(e,n){return i.sexpRangeExpansion(e,n,n)},sexpRangeExpansion:function(n,i,o){var u=t(e.flatFilterTree(n,function(e){return"toplevel"===e.type?!1:i===o?e.start<=i&&o<=e.end:e.start===i?o<e.end:e.end===o?e.start<i:e.start<i&&o<e.end},r));if(!u)return null;var l=u.start===i||u.end===o;if("list"===u.type||"string"===u.type){if(l&&(i===u.start||o===u.end))return[u.start,u.end];if(u.start+1<i||o<u.end-1)return[u.start+1,u.end-1]}return[u.start,u.end]},rangeForDefun:function(e,n){var t=e.children&&e.children.filter(function(e){return e.start<=n&&n<=e.end})[0];return t?[t.start,t.end]:null}},o=n.walk={hasChildren:function(e){return"list"===e.type||"toplevel"===e.type},containingSexpsAt:function(n,t,i){return e.flatFilterTree(n,function(e){return("toplevel"===e.type||e.start<t&&t<e.end)&&(!i||i(e))},r)},sexpsAt:function(n,t,i){return e.flatFilterTree(n,function(e){return e.start<=t&&t<=e.end&&(!i||i(e))},r)},nextSexp:function(n,i,u){var l=e.flatFilterTree(n,function(e){return e.start<=i&&i<e.end&&o.hasChildren(e)},r);if(!l.length)return null;var a=l.filter(function(e){return e.start===i&&"toplevel"!==e.type})[0];if(a)return a;var c=t(l).children.filter(function(e){return i<=e.start&&(!u||!!u(e))});return c.length?c[0]:null},prevSexp:function(n,i,u){var l=e.flatFilterTree(n,function(e){return e.start<i&&i<=e.end&&o.hasChildren(e)},r);if(!l.length)return null;var a=l.filter(function(e){return e.end===i&&"toplevel"!==e.type})[0];if(a)return a;var c=t(l).children.filter(function(e){return e.end<=i&&(!u||!!u(e))});return c.length?t(c):null},stringify:function(n){return e.mapTree(n,function(t,r){return"list"===t.type||"toplevel"===t.type?"("+r.join(" ")+")":t.source?t.source:e.times(n.end-n.start,"x")},function(e){return e&&e.children||[]})},source:function(e,n){return n.source?n.source:e.slice(n.start,n.end)}}}),function(e){var n="undefined"!=typeof module&&module.require,t=n?module.exports:window.paredit,r=n?module.require("./util").util:window.paredit.util,i=n?module.require("./navigator").navigator:window.paredit.navigator,o=n?module.require("./navigator").walk:window.paredit.walk;e(i,o,r,t)}(function(e,n,t,r){function i(e,n){return e.slice(0,n).lastIndexOf("\n")+1}function o(e,n){return n-i(e,n)}function u(e,n,t){if("toplevel"===n.type)return 0;var r=s(n,t);return d(n,e)?o(e,n.start+n.open.length+1):r.length<=1||"("!==n.open?o(e,n.start+n.open.length):o(e,r[1].start)}function l(e){return e[e.length-1]}function a(e,n){return new Array(e+1).join(n)}function c(e,n){return t.mapTree(n,function(n,r){return t.merge(n,{start:n.start+e,end:n.end+e,children:r})},function(e){return e.children})}function s(e,n){return e.children.filter(function(e){return e.end<=n})}function f(e,n){return e.children.filter(function(e){return n<=e.start})}function d(e){if(!n.hasChildren(e)||!e.children.length)return!1;var t=e.children[0].source;return t?r.specialForms.some(function(n){return"string"==typeof n?n===t:"function"==typeof n?n(t,e.children[0]):n instanceof RegExp?n.test(t):!1}):!1}r.specialForms=["&","monitor-exit",/^case/,"try",/^reify/,"finally",/^loop/,"do",/^let/,/^import/,"new",/^deftype/,/^let/,"fn","recur","set!",".","var","quote","catch","throw","monitor-enter","ns",/^def/,/^if/,/^when/,/->/,"while","for",/^with/,"testing","while","cond","condp"];var p=r.editor={rewrite:function(e,r,i){var o=i.length?l(i).end-r.end:r.start-r.end,u=n.containingSexpsAt(e,r.start),a=u.reduceRight(function(e,n){var r,i=n.children.indexOf(e.original);r=i>-1?n.children.slice(0,i).concat(e.nodes).concat(n.children.slice(i+1).map(c.bind(null,o))):n.children;var u=t.merge(n,{end:n.end+o,children:r});return{original:n,nodes:[u]}},{original:r,nodes:i});return a.nodes[0]},spliceSexp:function(e,t,r){var i=n.containingSexpsAt(e,r,n.hasChildren);if(!i.length)return null;var o=i.pop(),u="toplevel"===o.type,l=o.children.filter(function(e){return e.start<r&&r<e.end})[0],a=l&&"string"===l.type,c=[],s=r;return u||c.push(["remove",o.end-1,o.close.length]),a&&(c.push(["remove",l.end-1,l.close.length]),c.push(["remove",l.start,l.open.length]),s-=l.open.length),u||(c.push(["remove",o.start,o.open.length]),s-=o.open.length),{changes:c,newIndex:s}},spliceSexpKill:function(e,t,r,i){i=i||{};var o=(i.count||1,i.backward),u=n.containingSexpsAt(e,r,n.hasChildren);if(!u.length)return null;if(o)var a=s(l(u),r),c=this.killSexp(e,t,r,{count:a.length,backward:!0});else var d=f(l(u),r),c=this.killSexp(e,t,r,{count:d.length,backward:!1});var p=this.spliceSexp(e,t,r);if(!c)return p;if(!p)return c;var h=Array.prototype.slice.call(p.changes);return 2===h.length?h.splice(1,0,c.changes[0]):4===h.length&&h.splice(2,0,c.changes[0]),{changes:h,newIndex:c.newIndex-(3===h.length?1:2)}},splitSexp:function(e,t,r){var i=n.containingSexpsAt(e,r);if(!i.length)return null;var o=i.pop();if("toplevel"!==o.type){if(!n.hasChildren(o)&&"string"!==o.type)return null;var u=o.close+" "+o.open,l=r+o.close.length,a=[["insert",r,u]];return{changes:a,newIndex:l}}},killSexp:function(e,t,r,i){i=i||{};var o=i.count||1,u=i.backward,a=n.containingSexpsAt(e,r,n.hasChildren);if(!a.length)return null;var c=a.pop(),d=c.children.filter(function(e){return e.start<r&&r<e.end})[0];if(d){var p=u?d.start:r,h=u?r:d.end;return"string"===d.type&&(p+=u?d.open.length:0,h+=u?0:-d.close.length),{changes:[["remove",p,h-p]],newIndex:p}}if(d&&"string"===d.type){var p=u?d.start+d.open.length:r,h=u?r:d.end-d.close.length;return{changes:[["remove",p,h-p]],newIndex:p}}if(u){var g=s(c,r);if(!g.length)return null;var v=g.slice(-o)[0].start,x=[["remove",v,r-v]],m=v}else{var w=f(c,r);if(!w.length)return null;var m=r,x=[["remove",r,l(w.slice(0,o)).end-r]]}return{changes:x,newIndex:m}},wrapAround:function(e,t,r,i,o,u){var a=u&&u.count||1,c=n.containingSexpsAt(e,r,n.hasChildren);if(!c.length)return null;var s=l(c),f=s.children.filter(function(e){return e.start>=r}).slice(0,a),d=l(f),p=[["insert",r,i],["insert",(d?d.end:r)+i.length,o]];return{changes:p,newIndex:r+i.length}},closeAndNewline:function(e,t,r,i){i=i||")";var u=n.containingSexpsAt(e,r,function(e){return n.hasChildren(e)&&e.close===i});if(!u.length)return null;var c=l(u),s=a(o(t,c.start)," "),f="\n"+s,d=[["insert",c.end,f]];return{changes:d,newIndex:c.end+f.length}},barfSexp:function(e,t,r,i){var o=i&&i.backward,u=n.containingSexpsAt(e,r,n.hasChildren);if(!u.length)return null;var a=l(u);if(o){var c=s(a,r);if(!c.length)return null;var d=[["insert",c[1]?c[1].start:r,a.open],["remove",a.start,a.open.length]]}else{var p=f(a,r);if(!p.length)return;var d=[["remove",a.end-a.close.length,a.close.length],["insert",p[p.length-2]?p[p.length-2].end:r,a.close]]}return{changes:d,newIndex:r}},slurpSexp:function(e,t,r,i){var o=i&&i.backward,u=i.count||1,a=n.containingSexpsAt(e,r,n.hasChildren);if(a.length<2)return null;var c=a.pop(),d=a.pop();if(o){var p=s(d,r);if(!p.length)return;var h=[["remove",c.start,c.open.length],["insert",p.slice(-u)[0].start,c.open]]}else{var g=f(d,r);if(!g.length)return;var h=[["insert",l(g.slice(0,u)).end,c.close],["remove",c.end-c.close.length,c.close.length]]}return{changes:h,newIndex:r}},transpose:function(e,t,r,i){i=i||{};var o=n.containingSexpsAt(e,r,n.hasChildren),u=l(o),a=s(u,r),c=f(u,r);if(u.children.some(function(e){return e.start<r&&r<e.end}))return null;if(!a.length||!c.length)return null;var d=l(a),p=c[0],h=" "+n.source(t,d);return{changes:[["insert",p.end,h],["remove",d.start,p.start-d.start]],newIndex:d.start+(p.end-p.start)+h.length}},"delete":function(e,t,r,i){function o(e){return("string"===e.type||"list"===e.type)&&e.end-e.start===e.open.length+e.close.length}function u(e){return{changes:[["remove",e.start,e.end-e.start]],newIndex:e.start}}i=i||{};var a=i.count||1,c=!!i.backward,d=n.containingSexpsAt(e,r),p=d.filter(function(e){return n.hasChildren(e)}),h=l(p),g=l(d),v=h===g,x=v&&s(h,r),m=v&&f(h,r),w={changes:[],newIndex:r},y={changes:[["remove",c?r-a:r,a]],newIndex:c?r-a:r};if(!v&&"comment"===g.type)return y;if(x&&x.length&&c){var S=l(x);return S.end!==r||"symbol"===S.type||"comment"===S.type?y:o(S)||"char"===S.type?u(S):w}if(m&&m.length&&!c){var S=m[0];return S.start!==r||"symbol"===S.type||"comment"===S.type?y:o(S)||"char"===S.type?u(S):w}v||(h=g);var A=r===h.start+(h.open?h.open.length:0),b=r===h.end-(h.close?h.close.length:0);return h.children&&h.children.length||!(A&&c||b&&!c)?A&&c&&(v?h.children.length:h.end-h.start>1)?w:b&&!c&&(v?h.children.length:h.end-h.start>1)?w:y:u(h)},indentRange:function(e,r,o,s){var d=i(r,o),h=r.slice(s).indexOf("\n");h=h>-1?h+s:r.length;var g=r.slice(d,h).split("\n");return g.reduce(function(e,r){var i=e.idx,o=e.changes,s=e.ast,d=e.src,h=n.containingSexpsAt(s,i,n.hasChildren),g=l(h);if(!g)return{idx:i+r.length+1,newIndex:i,changes:o,ast:s,src:d};var v=r.match(/^\s*/)[0],x=u(d,g,i)-v.length,m=r.length+x;if(x>0){var w=a(x," ");o.push(["insert",i,w]),d=d.slice(0,i)+w+d.slice(i)}else 0>x&&(o.push(["remove",i,-x]),d=d.slice(0,i)+d.slice(i-x));var y=f(g,i)[0];if(y){var S=c(x,y);s=p.rewrite(s,y,[S])}else s=p.rewrite(s,g,[t.merge(g,{end:g.end+x})]);return{idx:i+m+1,newIndex:i+x,changes:o,ast:s,src:d}},{idx:d,changes:[],ast:e,src:r})}}});