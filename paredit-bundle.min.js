!function(){var n="undefined"!=typeof module&&module.require,e=n?module.exports:window.paredit={};n&&(e.reader=module.require("./lib/reader").reader,e.navigator=module.require("./lib/navigator").navigator,e.editor=module.require("./lib/editor").editor),e.parse=function(n,r){r=r||{};var t=!!r.addSourceForLeafs,i=[],o=e.reader.readSeq(n,function(e,r,o,u,l){var a={type:e,start:o.idx,end:u.idx};return"error"===e?(a.error=r.error,i.push(a)):t&&"list"!==e&&(a.source=n.slice(a.start,a.end)),"list"===e&&(a.children=r),("list"===e||"string"===e)&&(a.open=l.open,a.close=l.close),a});return{type:"toplevel",start:0,end:o&&o.length&&o[o.length-1].end||0,errors:i,children:o}}}(),function(n){var e="undefined"!=typeof module&&module.require,r=e?module.exports:window.paredit;n(r)}(function(n){var e=n.util={merge:function(n){return arguments.length>1?e.merge(Array.prototype.slice.call(arguments)):Array.isArray(n[0])?Array.prototype.concat.apply([],n):n.reduce(function(n,e){for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n},{})},mapTree:function(n,r,t){var i=(t(n)||[]).map(function(n){return e.mapTree(n,r,t)});return r(n,i)},flatFilterTree:function(n,r,t){var i=[];return r(n)&&i.push(n),i.concat((t(n)||[]).reduce(function(n,i){return n.concat(e.flatFilterTree(i,r,t))},[]))},last:function(n){return n[n.length-1]},times:function(n,e){return new Array(n+1).join(e)},clone:function(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e={};for(var r in n)e[r]=n[r];return e}}}),function(n){var e="undefined"!=typeof module&&module.require,r=e?module.exports:window.paredit;n(r)}(function(n){function e(n,e,d,p,v){var g=e[0];if(!g&&n&&y[n])return{input:e,context:d,pos:p,flag:w};if(!g&&!y[n])return{input:e,context:d,pos:p,flag:w};if(/\s|,/.test(g))return{input:e.slice(1),context:d,pos:x(p,g)};if(q.test(g))return a(e,d,p,v);if(";"===g)return l(e,d,p,v);if('"'===g)return t(e,d,p,v);if("\\"===g)return i(e,d,p,v);if(/[0-9]/.test(g))return u(e,d,p,v);if(b.test(g))return o(e,d,p,v);if(A.indexOf(g)>-1){if(!n){var O=c(e,d,p,v);return{input:O.input,context:O.context,pos:O.pos}}return{input:e,context:d,pos:p,flag:m}}if(S.indexOf(g)>-1){var k,C,F=h(p),I=r(g,e.slice(1),Object.freeze([]),x(p,g),v),T=I.input[0];if(T!==y[g]){var j=h(I.pos),R="Expected '"+y[g]+"'"+(T?" but got '"+T+"'":" but reached end of input"),E=s(R,F,j);k=f(v,"error",E,F,j),C=T?x(I.pos,T):I.pos}else C=T?x(I.pos,T):I.pos,k=f(v,"list",I.context,F,C,{open:g,close:y[g]});d=d.concat([k]);var z=I.input.slice(T?1:0);return{input:z,context:d,pos:C}}var F=h(p),j=x(p,g),E=s("Unexpected character: "+g,F,j);return E=f(v,"error",E,F,j),d=d.concat([E]),{input:e.slice(1),context:d,pos:j}}function r(n,r,t,i,o){for(var u,l=0;;){if(l++,l>1e4)throw new Error("endless loop at "+v(i));if(u=e(n,r,t,i,o),r=u.input,t=u.context,i=u.pos,u.flag===w||u.flag===m&&(n||!r.length))break}return{input:r,context:t,pos:i}}function t(n,e,r,t){var i=!1,o=h(r),u=n[0];return r=x(r,n[0]),n=n.slice(1),d(n,r,function(n){return i||'"'!==n?(i?i=!1:"\\"===n&&(i=!0),!0):!1},function(n,r,i,l){u=u+n+r[0],l=x(l,r[0]),r=r.slice(1);var a=f(t,"string",u,o,l,{open:'"',close:'"'});return e=e.concat([a]),{pos:l,input:r,context:e}})}function i(n,e,r,t){var i=h(r),o=n.slice(0,2),u=x(r,o),l=f(t,"char",o,i,u),a=n.slice(2);return e=e.concat([l]),{pos:u,input:a,context:e}}function o(n,e,r,t){return d(n,r,function(n){return b.test(n)},function(n,r,i,o){var u=f(t,"symbol",n,i,o);return e=e.concat([u]),{pos:o,input:r,context:e}})}function u(n,e,r,t){return d(n,r,function(n){return/[0-9]/.test(n)},function(n,r,i,o){var u=f(t,"number",Number(n),i,o);return e=e.concat([u]),{pos:o,input:r,context:e}})}function l(n,e,r,t){for(var i=h(r),o="",u=n;u.length&&/^\s*;/.test(u);){var l=g(u);o+=l[0],u=l[1]}var a=x(r,o),c=f(t,"comment",o,i,a);return e=e.concat([c]),{pos:a,input:u,context:e}}function a(n,e,r,t){return d(n,r,function(n){return q.test(n)},function(n,r,i,o){var u=f(t,"special",n,i,o);return e=e.concat([u]),{pos:o,input:r,context:e}})}function c(n,e,r,t){return d(n,r,function(n){return A.indexOf(n)>-1},function(n,r,i,o){var u=s("Unexpected input: '"+n+"'",i,o),l=f(t,"error",u,i,o);return e=e.concat([l]),{pos:o,input:r,context:e}})}function s(n,e,r){return{error:n+" at line "+(r.row+1)+" column "+r.column,start:h(e),end:h(r)}}function f(n,e,r,t,i,o){return n?n(e,r,h(t),h(i),o):r}function d(n,e,r,t){for(var i=h(e),o="",u=0;u<n.length&&r(n[u]);u++)o+=n[u];return t(o,n.slice(o.length),i,x(e,o))}function p(){return{idx:0,column:0,row:0}}function h(n){return{idx:n.idx,column:n.column,row:n.row}}function v(n){return JSON.stringify(n)}function g(n){var e=n.indexOf("\n");e=e>-1?e+1:n.length;var r=n.slice(0,e),t=n.slice(e);return[r,t]}function x(n,e){n.idx+=e.length;var r=e.split("\n"),t=r.length;n.row+=t-1;var i=r[t-1].length;return n.column=t>1?i:n.column+i,n}n.reader={readSeq:function(n,e){return r(null,n,Object.freeze([]),p(),e).context},readSexp:function(n,r){return e(null,n,Object.freeze([]),p(),r).context[0]}};var m={},w={},y={"[":"]","(":")","{":"}"},S=Object.keys(y),A=S.map(function(n){return y[n]}),b=/[^\s\[\]\(\)\{\},]/,q=/[`@^#~]/}),function(n){var e="undefined"!=typeof module&&module.require,r=e?module.exports:window.paredit,t=e?module.require("./util").util:window.paredit.util;n(t,r)}(function(n,e){function r(n){return n[n.length-1]}function t(n){return n.children||[]}var i=e.navigator={forwardSexp:function(n,e){var r=o.nextSexp(n,e);return r?r.end:e},backwardSexp:function(n,e){var r=o.prevSexp(n,e);return r?r.start:e},forwardDownSexp:function(n,e){var r=o.nextSexp(n,e,function(n){return"list"===n.type});return r?r.children&&r.children[0]?r.children[0].start:r.start+1:e},backwardUpSexp:function(n,e){var t=o.sexpsAt(n,e,function(n){return"list"===n.type&&n.start!==e&&n.end!==e});return t&&t.length?r(t).start:e},sexpRange:function(n,e){return i.sexpRangeExpansion(n,e,e)},sexpRangeExpansion:function(e,i,o){var u=r(n.flatFilterTree(e,function(n){return"toplevel"===n.type?!1:i===o?n.start<=i&&o<=n.end:n.start===i?o<n.end:n.end===o?n.start<i:n.start<i&&o<n.end},t));if(!u)return null;var l=u.start===i||u.end===o;if("list"===u.type||"string"===u.type){if(l&&(i===u.start||o===u.end))return[u.start,u.end];if(u.start+1<i||o<u.end-1)return[u.start+1,u.end-1]}return[u.start,u.end]},rangeForDefun:function(n,e){var r=n.children&&n.children.filter(function(n){return n.start<=e&&e<=n.end})[0];return r?[r.start,r.end]:null}},o=e.walk={hasChildren:function(n){return"list"===n.type||"toplevel"===n.type},containingSexpsAt:function(e,r,i){return n.flatFilterTree(e,function(n){return("toplevel"===n.type||n.start<r&&r<n.end)&&(!i||i(n))},t)},sexpsAt:function(e,r,i){return n.flatFilterTree(e,function(n){return n.start<=r&&r<=n.end&&(!i||i(n))},t)},nextSexp:function(e,i,u){var l=n.flatFilterTree(e,function(n){return n.start<=i&&i<n.end&&o.hasChildren(n)},t);if(!l.length)return null;var a=l.filter(function(n){return n.start===i&&"toplevel"!==n.type})[0];if(a)return a;var c=r(l).children.filter(function(n){return i<=n.start&&(!u||!!u(n))});return c.length?c[0]:null},prevSexp:function(e,i,u){var l=n.flatFilterTree(e,function(n){return n.start<i&&i<=n.end&&o.hasChildren(n)},t);if(!l.length)return null;var a=l.filter(function(n){return n.end===i&&"toplevel"!==n.type})[0];if(a)return a;var c=r(l).children.filter(function(n){return n.end<=i&&(!u||!!u(n))});return c.length?r(c):null},stringify:function(e){return n.mapTree(e,function(r,t){return"list"===r.type||"toplevel"===r.type?"("+t.join(" ")+")":r.source?r.source:n.times(e.end-e.start,"x")},function(n){return n&&n.children||[]})}}}),function(n){var e="undefined"!=typeof module&&module.require,r=e?module.exports:window.paredit,t=e?module.require("./util").util:window.paredit.util,i=e?module.require("./navigator").navigator:window.paredit.navigator,o=e?module.require("./navigator").walk:window.paredit.walk;n(i,o,t,r)}(function(n,e,r,t){function i(n,e){return n.slice(0,e).lastIndexOf("\n")+1}function o(n,e){return e-i(n,e)}function u(n,e,r){if("toplevel"===e.type)return 0;var t=s(e,r);return d(e,n)?o(n,e.start+e.open.length+1):t.length<=1||"("!==e.open?o(n,e.start+e.open.length):o(n,t[1].start)}function l(n){return n[n.length-1]}function a(n,e){return new Array(n+1).join(e)}function c(n,e){return r.mapTree(e,function(e,t){return r.merge(e,{start:e.start+n,end:e.end+n,children:t})},function(n){return n.children})}function s(n,e){return n.children.filter(function(n){return n.end<=e})}function f(n,e){return n.children.filter(function(n){return e<=n.start})}function d(n){if(!e.hasChildren(n)||!n.children.length)return!1;var r=n.children[0].source;return r?t.specialForms.some(function(e){return"string"==typeof e?e===r:"function"==typeof e?e(r,n.children[0]):e instanceof RegExp?e.test(r):!1}):!1}t.specialForms=["&","monitor-exit",/^case/,"try",/^reify/,"finally",/^loop/,"do",/^let/,/^import/,"new",/^deftype/,/^let/,"fn","recur","set!",".","var","quote","catch","throw","monitor-enter","ns",/^def/,/^if/,/^when/,/->/,"while","for",/^with/,"testing","while","cond","condp"];var p=t.editor={rewrite:function(n,t,i){var o=i.length?l(i).end-t.end:t.start-t.end,u=e.containingSexpsAt(n,t.start),a=u.reduceRight(function(n,e){var t,i=e.children.indexOf(n.original);t=i>-1?e.children.slice(0,i).concat(n.nodes).concat(e.children.slice(i+1).map(c.bind(null,o))):e.children;var u=r.merge(e,{end:e.end+o,children:t});return{original:e,nodes:[u]}},{original:t,nodes:i});return a.nodes[0]},spliceSexp:function(n,r,t){var i=e.containingSexpsAt(n,t,e.hasChildren);if(!i.length)return null;var o=i.pop(),u=t-o.open.length,l=[["remove",o.end-1,o.close.length],["remove",o.start,o.open.length]];return{changes:l,newIndex:u}},splitSexp:function(n,r,t){var i=e.containingSexpsAt(n,t);if(!i.length)return null;var o=i.pop();if(!e.hasChildren(o)&&"string"!==o.type)return null;var u=o.close+" "+o.open,l=t+o.close.length,a=[["insert",t,u]];return{changes:a,newIndex:l}},killSexp:function(n,r,t,i){i=i||{};var o=i.count||1,u=i.backward,a=e.containingSexpsAt(n,t,e.hasChildren);if(!a.length)return null;var c=a.pop();if(u){var d=s(c,t);if(!d.length)return null;var p=d.slice(-o)[0].start,h=[["remove",p,t-p]],v=p}else{var g=f(c,t);if(!g.length)return null;var v=t,h=[["remove",t,l(g.slice(0,o)).end-t]]}return{changes:h,newIndex:v}},wrapAround:function(n,r,t,i,o,u){var a=u&&u.count||1,c=e.containingSexpsAt(n,t,e.hasChildren);if(!c.length)return null;var s=l(c),f=s.children.filter(function(n){return n.start>=t}).slice(0,a),d=l(f),p=[["insert",t,i],["insert",(d?d.end:t)+i.length,o]];return{changes:p,newIndex:t+i.length}},closeAndNewline:function(n,r,t,i){i=i||")";var u=e.containingSexpsAt(n,t,function(n){return e.hasChildren(n)&&n.close===i});if(!u.length)return null;var c=l(u),s=a(o(r,c.start)," "),f="\n"+s,d=[["insert",c.end,f]];return{changes:d,newIndex:c.end+f.length}},barfSexp:function(n,r,t,i){var o=i&&i.backward,u=e.containingSexpsAt(n,t,e.hasChildren);if(!u.length)return null;var a=l(u);if(o){var c=s(a,t);if(!c.length)return null;var d=[["insert",c[1]?c[1].start:t,a.open],["remove",a.start,a.open.length]]}else{var p=f(a,t);if(!p.length)return;var d=[["remove",a.end-a.close.length,a.close.length],["insert",p[p.length-2]?p[p.length-2].end:t,a.close]]}return{changes:d,newIndex:t}},slurpSexp:function(n,r,t,i){var o=i&&i.backward,u=i.count||1,a=e.containingSexpsAt(n,t,e.hasChildren);if(a.length<2)return null;var c=a.pop(),d=a.pop();if(o){var p=s(d,t);if(!p.length)return;var h=[["remove",c.start,c.open.length],["insert",p.slice(-u)[0].start,c.open]]}else{var v=f(d,t);if(!v.length)return;var h=[["insert",l(v.slice(0,u)).end,c.close],["remove",c.end-c.close.length,c.close.length]]}return{changes:h,newIndex:t}},"delete":function(n,e,r,t){t=t||{};var i=t.count||1,o=!!t.backward,u=[["remove",o?r-i:r,i]];return{changes:u,newIndex:o?r-i:r}},indentRange:function(n,t,o,s){var d=i(t,o),h=t.slice(s).indexOf("\n");h=h>-1?h+s:t.length;var v=t.slice(d,h).split("\n");return v.reduce(function(n,t){var i=n.idx,o=n.changes,s=n.ast,d=n.src,h=e.containingSexpsAt(s,i,e.hasChildren),v=l(h);if(!v)return{idx:i+t.length+1,newIndex:i,changes:o,ast:s,src:d};var g=t.match(/^\s*/)[0],x=u(d,v,i)-g.length,m=t.length+x;if(x>0){var w=a(x," ");o.push(["insert",i,w]),d=d.slice(0,i)+w+d.slice(i)}else 0>x&&(o.push(["remove",i,-x]),d=d.slice(0,i)+d.slice(i-x));var y=f(v,i)[0];if(y){var S=c(x,y);s=p.rewrite(s,y,[S])}else s=p.rewrite(s,v,[r.merge(v,{end:v.end+x})]);return{idx:i+m+1,newIndex:i+x,changes:o,ast:s,src:d}},{idx:d,changes:[],ast:n,src:t})}}});